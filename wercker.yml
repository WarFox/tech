box: node:8.9.4-stretch

build:
  steps:
    - npm-install

    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"
    - script:
        name: Install Hexo
        code: |
          npm install -g hexo-cli
    - script:
        name: Rebuild node-sass
        code: |
          npm rebuild node-sass
    - script:
        name: Generate static files
        code: |
          hexo generate

deploy:
  steps:
    - script:
        name: install s3cmd
        code: |
          apt update
          apt install python-certifi=2016.2.28-1 s3cmd=1.6.1-1 -y
    - script:
        name: Sync to S3
        code: |
          s3cmd sync public/ $AWS_BUCKET_URL --access_key=$AWS_ACCESS_KEY_ID --secret_key=$AWS_SECRET_ACCESS_KEY --region=$AWS_REGION
